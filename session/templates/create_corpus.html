{% extends "base.html" %}

{% block content %}
    sdfsdfmer-e√∂fl
    {% include 'create_corpus_content.html' %}
{% endblock content %}



{% block javascripts %}
    {{ block.super }}
    {% load staticfiles %}
    <script src="{% static 'js/create_corpus_view.js' %}"></script>

    <script>
        var corpusView = CorpusView();
        corpusView.init();

{#        function updateProgressbar(progress) {#}
{#            console.log("update progress: ", progress)#}
{#            $(".progress-bar").attr("aria-valuenow", progress);#}
{#            $(".progress-bar").width(progress + "%");#}
{#        };#}
{##}
{#        function disableForm() {#}
{#            $("form").hide();#}
{#        };#}
{##}
{#        function showProgressBar() {#}
{##}
{#        };#}

        // Fetch corpus creation progress and update progressbar
{#        function poll(){#}
{#            $.getJSON("{% url 'session.views.checkCorpusCreationProgress' %}", function(data) {#}
{#                console.log("progress: ", data);#}
{#                updateProgressbar(data.progress)#}
{#                if(data.working) setTimeout(poll, 200);#}
{#                else $("form").trigger("corpusCreationFinished");#}
{#            });#}
{#        };#}

        $(document).ready(function() {

{#            var id = $("#sid").data("sessionid");#}
{#            console.log(id);#}
{##}
{#            var socket = io.connect('http://localhost:3000');#}
{#            socket.emit("connect", id);#}
{#            socket.on('corpuscreation_progress', function (data) {#}
{#                var status = JSON.parse(data);#}
{#                console.log("status: ", status);#}
{##}
{#                // 1 = download tweets#}
{#                // 2 = save tweets to file#}
{#                switch(status.task) {#}
{#                    case 1:#}
{#                        var currentStep = status.steps[0],#}
{#                        totalFetched = currentStep.numFetched + currentStep.numFailed,#}
{#                        percent = totalFetched / currentStep.numTotal * 100;#}
{##}
{#                            console.log("Update progress to ", percent);#}
{#                        updateProgressbar(percent);#}
{#                        $("#progress-progress").text("Lade Tweet " + totalFetched + " / " + currentStep.numTotal);#}
{#                        break;#}
{#                    case 2:#}
{#                        var currentStep = status.steps[1];#}
{#                        $("#progress-progress").text("Speichere tweet " + currentStep.numSaved + " / " + currentStep.numTotal);#}
{#                        if(currentStep.numSaved === currentStep.numTotal) $("form").trigger("corpusCreationFinished");#}
{#                        break;#}
{#                }#}
{##}
{#            });#}


{#            $("form").on("startCorpusCreation", function() {#}
{#                disableForm();#}
{#                $("#form-progress").removeClass("hidden");#}
{#                poll();#}
{#            });#}
{##}
{#            $("form").on("corpusCreationFinished", function() {#}
{#                console.log("finished")#}
{#                updateProgressbar(0);#}
{#                $("form").show();#}
{#                $("#form-progress").addClass("hidden");#}
{#            });#}
        });
    </script>
{% endblock javascripts %}