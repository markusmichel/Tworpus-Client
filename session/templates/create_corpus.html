{% extends "base.html" %}

{% block content %}

<p>
    Neuen Korpus erstellen:
</p>

<form role="form" action="{% url 'session.views.startCreateCorpus' %}">

    <div class="form-group">
        <label for="input_title">Titel</label>
        <input type="text" class="form-control" id="input_title" placeholder="Titel des Projekts">
    </div>

    <div class="form-group">
        <label for="">Sprache</label>
        <select id="select-language">
            <option value="de">deutsch</option>
            <option value="en">englisch</option>
            <option value="fr">französisch</option>
            <option value="es">spanisch</option>
        </select>
    </div>

    <div class="form-group">
        <label for="">Zeitraum</label>

    </div>

    <div class="form-group">
        <label for="input_slider_num_tweets">Anzahl an Tweets</label>
        <br/>
        <div class="row">
            <div class="col-lg-4">
                <input id="input_slider_num_tweets"
                   type="text"
                   class="slider"
                   value=""
                   data-slider-min="20"
                   data-slider-max="100000"
                   data-slider-step="20"
                   data-slider-value="20"
                   data-slider-orientation="horizontal"
                   data-slider-selection="after"
                   data-slider-tooltip="show">
            </div>
            <div class="col-lg-4">
                <input type="number" min="20" max="100000" step="20" value="20" id="input_num_tweets" class="form-control col-lg-2" value="0" />
            </div>
        </div>
    </div>

    <div class="form-group">
        <label for="input_slider_min_chars">Minimale Anzahl an Buchstaben pro Tweet</label>
        <br/>
        <div class="row">
            <div class="col-lg-4">
                <input id="input_slider_min_chars"
                   type="text"
                   class="slider"
                   value=""
                   data-slider-min="0"
                   data-slider-max="100"
                   data-slider-step="1"
                   data-slider-value="5"
                   data-slider-orientation="horizontal"
                   data-slider-selection="after"
                   data-slider-tooltip="show">
            </div>
            <div class="col-lg-4">
                <input type="number" min="0" max="100" value="5" id="input_min_chars" class="form-control col-lg-2" value="0" />
            </div>
        </div>
    </div>

    <div class="form-group">
        <label for="input_slider_min_words">Minimale Anzahl an Wörtern pro Tweet</label>
        <br/>
        <div class="row">
            <div class="col-lg-4">
                <input id="input_slider_min_words"
                   type="text"
                   class="slider"
                   value=""
                   data-slider-min="0"
                   data-slider-max="100"
                   data-slider-step="1"
                   data-slider-value="5"
                   data-slider-orientation="horizontal"
                   data-slider-selection="after"
                   data-slider-tooltip="show">
            </div>
            <div class="col-lg-4">
                <input type="number" min="0" max="100" value="5" id="input_min_words" class="form-control col-lg-2" value="0" />
            </div>
        </div>
    </div>

    <button type="submit" class="btn btn-default">erstellen</button>

</form>


<div id="form-progress" class="hidden">
    <div class="progress">
        <div class="progress-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 0%;">
            <span class="sr-only">60% Complete</span>
        </div>
    </div>
</div>

{% endblock content %}



{% block javascripts %}
    {{ block.super }}
    {% load staticfiles %}
    <script src="{% static 'components/slider/js/bootstrap-slider.js' %}"></script>
    <script src="{% static 'js/create_corpus_view.js' %}"></script>

    <script>

        var corpusView = CorpusView();
        corpusView.init();

        $(corpusView).on("foo", function() {
            console.log("bar");
        });

        function updateProgressbar(progress) {
            console.log("update progress: ", progress)
            $(".progress-bar").attr("aria-valuenow", progress);
            $(".progress-bar").width(progress + "%");
        };

        function disableForm() {
            $("form").hide();
        };

        function showProgressBar() {

        };

        // Fetch corpus creation progress and update progressbar
        function poll(){
            $.getJSON("{% url 'session.views.checkCorpusCreationProgress' %}", function(data) {
                console.log("progress: ", data);
                updateProgressbar(data.progress)
                if(data.working) setTimeout(poll, 200);
                else $("form").trigger("corpusCreationFinished");
            });
        };

        $(document).ready(function() {
            $("form").on("startCorpusCreation", function() {
                disableForm();
                $("#form-progress").removeClass("hidden");
                poll();
            });

            $("form").on("corpusCreationFinished", function() {
                console.log("finished")
                updateProgressbar(0);
                $("form").show();
                $("#form-progress").addClass("hidden");
            });
        });
    </script>
{% endblock javascripts %}