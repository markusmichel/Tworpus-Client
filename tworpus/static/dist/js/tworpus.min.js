tworpusApp.config(["$routeProvider",function(a){a.when("/createcorpus",{templateUrl:"/static/views/create_corpus_content.html",controller:"CreateCorpusController"}).when("/corpora",{templateUrl:"/static/views/corpora.html",controller:"CorporaController"}).when("/cache",{templateUrl:"/static/views/cache.html",controller:"CacheController"}).otherwise({redirectTo:"/createcorpus"})}]).controller("CreateCorpusController",["$scope","$rootScope","$http","urls","corpusCreationService","notify",function(a,b,c,d,e,f){a.slider={},a.slider.config={},a.slider.config.minTweetLength=0,a.slider.config.maxTweetLength=140,a.corpus={},a.languages=[{name:"German",value:"de"},{name:"English",value:"en"},{name:"Spanish",value:"es"},{name:"French",value:"fr"},{name:"Italian",value:"it"},{name:"Dutch",value:"nl"},{name:"Portuguese",value:"pt"},{name:"Turkish",value:"tr"}],a.startCreateCorpus=function(){var c=$("form").get(0).checkValidity();c===!0&&e.startCorpusCreation(a.corpus).success(function(){f("Korpus <b>"+a.corpus.title+" </b>wird erstellt"),b.$emit("corpus:create:start")}).error(function(a,b){switch(console.log("data: ",a),console.log("statu: ",b),b){case 409:f("No tweets found to fetch. Try to be less specific.","error");break;default:f("Failed to fetch tweets.","error")}})}}]).directive("ngBootstrapSlider",function(){return{restrict:"A",scope:{ngModel:"="},require:"ngModel",link:function(a,b,c){a.ngModel=parseInt(c.sliderValue)||0;var d=$(b).slider({value:0});a.slider=d,d.on("slide",function(){var b=$(this).val();a.corpus.ngModel=parseInt(b),a.$apply()})},controller:function(a){a.$watch("ngModel",function(b){a.slider.slider("setValue",b)})}}}).directive("twDate",function(){return{restrict:"A",scope:{ngModel:"=",minDate:"=",maxDate:"="},require:"ngModel",link:function(a,b){var c=new Pikaday({field:b[0],bound:!1,onSelect:function(b){a.ngModel=b||new Date,a.$apply()}});a.$watch("ngModel",function(a){c.setDate(a,!0)}),a.$watch("minDate",function(b){c.setMinDate(b),c.setDate(a.ngModel,!0)}),a.$watch("maxDate",function(b){c.setMaxDate(b),c.setDate(a.ngModel,!0)})}}}).controller("twDateRangeController",["$scope",function(a){var b=864e5,c=new Date;c.setTime(c.getTime()-10*b),a.$parent.corpus.startDate=c;var d=new Date;d.setHours(23),d.setMinutes(59),d.setTime(d.getTime()+b),a.$parent.corpus.endDate=d,a.startDate={},a.endDate={maxDate:d},a.$watch("corpus.startDate",function(b){a.corpus&&(b>a.corpus.endDate&&(a.corpus.startDate=a.corpus.endDate),a.endDate.minDate=b)}),a.$watch("corpus.endDate",function(b){a.corpus&&(b<a.corpus.startDate&&(a.corpus.endDate=a.corpus.startDate),a.startDate.maxDate=b)})}]);var pieChartConfig={width:250,height:250,innerRadius:80,colors:["#379A8C","#ED5564","#EBEBEB"]},createPieChart=function(a){return d3.select(a.get(0)).append("svg").attr("width",pieChartConfig.width).attr("height",pieChartConfig.height).append("svg:g").attr("transform","translate("+pieChartConfig.width/2+","+pieChartConfig.height/2+")")},updatePieChart=function(a,b){function c(a){var b=d3.interpolate(this._current,a);return this._current=b(0),function(a){return g(b(a))}}function d(a){return a.innerRadius=0,a.outerRadius=e,"translate("+g.centroid(a)+")"}var e=Math.min(pieChartConfig.width,pieChartConfig.height)/2,f=d3.layout.pie().startAngle(1.1*Math.PI).endAngle(3.1*Math.PI).sort(null).value(function(a){return a}),g=d3.svg.arc().outerRadius(e).innerRadius(e-pieChartConfig.innerRadius),h=a.selectAll("path").data(f(b)),i=a.selectAll("text").data(f(b));h.enter().append("path").attr("fill",function(a,b){return pieChartConfig.colors[b]}).attr("d",g).each(function(a){this._current=a}),i.enter().append("text").attr("transform",d).attr("text-anchor","middle").attr("font-weight","bold"),h.transition().attrTween("d",c),i.transition().attr("transform",d),i.text(function(a,c){return 0==b[c]?null:b[c]}),h.exit().remove(),i.exit().remove()},updateCorpusView=function(a,b){var c=b.find(".corpus-view-details-created");c.text(moment(a.created).format("MM/DD/YYYY"));var d=b.find(".corpus-view-details"),e=b.find(".corpus-view-buttonbar");b.hover(function(){d.addClass("move-in"),e.addClass("move-in")},function(){d.removeClass("move-in"),e.removeClass("move-in")})};tworpusApp.controller("CorporaController",["$scope","corpusCreations",function(a,b){a.corpusCreations=b.corpusCreationProcesses,a.remove=b.remove,b.fetchAll()}]).directive("twCreateCorporaView",["corpusCreations","$filter",function(a){return{restrict:"A",scope:{ngModel:"="},require:"ngModel",link:function(b,c){var d=b.ngModel;if(!d)return void $(c).parent().remove();var e=$(c),f=e.find(".corpus-view-details-tweets-fetched"),g=e.find(".corpus-view-details-tweets-failed");updateCorpusView(d,e);var h=createPieChart(c);updatePieChart(h,[d.tweetsFetched,d.tweetsFailed,d.numTweets-d.tweetsFetched-d.tweetsFailed]),b.processes=a.corpusCreationProcesses,b.$watch("ngModel",function(a){a.progress<=100&&(f.text("Tweets fetched: "+a.tweetsFetched),g.text("Tweets failed: "+a.tweetsFailed),updatePieChart(h,[a.tweetsFetched,a.tweetsFailed,a.numTweets-d.tweetsFetched-d.tweetsFailed]))},!0)}}}]),angular.module("tworpusApp.cache",["ngAnimate"]).controller("CacheController",["$scope","$http","urls","notify",function(a,b,c,d){a.clearCache=function(){a.showClearConfirmation=!1,b.post(c.clearCache).success(function(){d("Cache cleared"),e()}).error(function(){d("Failed to clear cache")})};var e=function(){b.get(c.cacheStatus).success(function(b){a.numFiles=b.numFiles,a.size=b.size})};e();var f=setInterval(e,5e3);a.$on("$destroy",function(){clearInterval(f)}),a.showClearConfirmation=!1}]).filter("bytes",function(){return function(a,b){if(0===a)return"0 bytes";if(isNaN(parseFloat(a))||!isFinite(a))return"";"undefined"==typeof b&&(b=1);var c=["bytes","kB","MB","GB","TB","PB"],d=Math.floor(Math.log(a)/Math.log(1024));return(a/Math.pow(1024,Math.floor(d))).toFixed(b)+" "+c[d]}}),angular.module("createCorpus.services",[]).service("corpusCreationService",["$http","urls",function(a,b){this.startCorpusCreation=function(c){return c.startDateTimestamp=c.startDate,c.startDateTimestamp.setHours(0),c.startDateTimestamp.setMinutes(0),c.startDateTimestamp=c.startDateTimestamp.getTime(),c.endDateTimestamp=c.endDate,c.endDateTimestamp.setHours(0),c.endDateTimestamp.setMinutes(0),c.endDateTimestamp=c.endDateTimestamp.getTime(),a({method:"POST",url:b.startCreateCorpus,data:c})}}]),angular.module("navigation",[]).directive("twNavigation",["$location",function(a){return{restrict:"A",link:function(b,c){var d=c.attr("href").substr(1);b.$watch(function(){return a.path()},function(){d===a.path()?c.closest("li").addClass("active"):c.closest("li").removeClass("active")})}}}]),angular.module("notifications",[]).factory("notify",[function(){return function(a,b){b=b||"success",console.log("notifification: ",a),console.log("notifification type: ",b),$.pnotify({text:a,type:b})}}]),angular.module("tworpusApp.progress",["tworpusApp.progress.services"]).directive("twCorpusProgress",[function(){return{templateUrl:"/static/views/corpus_creation_progress.html",replace:!0,scope:{twProgresses:"="},link:function(a){a.$parent.$watch("showProgressbar",function(a){a===!0?$("body").addClass("progressbar-expanded"):$("body").removeClass("progressbar-expanded")})}}}]).filter("unfinished",function(){return function(a){var b=[];return angular.forEach(a,function(a){a.completed===!1&&b.push(a)}),b}}).filter("working",function(){return function(a){var b=[];return angular.forEach(a,function(a){a.working===!0&&b.push(a)}),b}}).filter("corpusid",function(){return function(a,b){var c=null;for(var d in a){a[d].id===b&&(c=a[d]);break}return c}}).filter("indexOfCorpusid",function(){return function(a,b){var c=null;for(var d in a)if(a[d].id===b){c=d;break}return c}}).controller("ProgressController",["$scope","$rootScope","$http","$filter","corpusCreations","urls",function(a,b,c,d,e,f){a.corpusCreationProcesses=e.corpusCreationProcesses,a.showProgressbar=!1;var g=function(){e.fetchAll()};g(),b.$on("corpus:create:start",function(){a.showProgressbar=!0,e.fetchAll().success(function(){})}),a.toggleShowProgressbar=function(){a.showProgressbar=!a.showProgressbar},a.removeCorpus=function(a){e.remove(a)},a.pause=function(a){c.get(f.pauseCorpus+"?id="+a).then(function(){g()})},a.resume=function(a){c.get(f.resumeCorpus+"?id="+a).then(function(){e.fetch(a).then(e.longPoll())})};a.$watchCollection("corpusCreationProcesses",function(){var b=d("working")(e.corpusCreationProcesses);b.length>0&&e.longPoll(),0==e.corpusCreationProcesses.length&&(a.showProgressbar=!1)})}]),angular.module("tworpusApp.progress.services",[]).service("corpusCreations",["$http","$filter","urls","socketId","notify",function(a,b,c,d,e){var f=this;this.corpusCreationProcesses=[],this.pause=function(){};var g=!1,h=0;this.longPoll=function(){g||i()};var i=function(){g=!0;var a=b("working")(f.corpusCreationProcesses);return 0===a.length&&++h>=3?(g=!1,void(h=0)):(angular.forEach(a,function(a){f.fetch(a.id)}),void setTimeout(function(){i()},200))};this.fetch=function(d){return d=new String(d),a.get(c.session+"?id="+d).success(function(a){var c=b("indexOfCorpusid")(f.corpusCreationProcesses,a.id),d=f.corpusCreationProcesses[c];d.progress=a.progress,d.completed=a.completed,d.working=a.working,d.tweetsFetched=a.tweetsFetched,d.tweetsFailed=a.tweetsFailed})},this.fetchAll=function(){return a.get(c.sessions).success(function(a){angular.forEach(a,function(a){var c=b("indexOfCorpusid")(f.corpusCreationProcesses,a.id);null===c&&f.corpusCreationProcesses.push(a)})})},this.remove=function(d){var g=b("indexOfCorpusid")(f.corpusCreationProcesses,d),h=f.corpusCreationProcesses.splice(g,1),i=c.removeCorpus+"?corpusid="+d;h.length>0?(h=h[0],a.get(i).success(function(){e("Korpus <b>"+h.title+" </b>wurde entfernt")}).error(function(){e("Corpus "+h.title+" couldn't be removed")})):e("Element could not be found")}}]);